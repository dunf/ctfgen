heat_template_version: 2015-10-15

description: >
  Generic Linux server HOT template 

parameters:
  key_name:
    type: string
  image_linux:
    type: string
    default: Ubuntu Server 18.04 LTS (Bionic Beaver) amd64
  flavor_linux_server:
    type: string
    default: m1.small
  sec_group_linux:
    type: comma_delimited_list
    default: FooRules,default
  group_net_name:
    type: string
  subnetA:
    type: string
    default: subnetA
  subnetB:
    type: string
    default: subnetB
  server_name:
    type: string
    description: Server name
  public_net:
    type: string

resources:
 
  linux_server:
    type: OS::Nova::Server
    properties:
      name:             { get_param: server_name }
      image:            { get_param: image_linux }
      flavor:           { get_param: flavor_linux_server }
      key_name:         { get_param: key_name }
      networks:
        - port:         { get_resource: linux_server_port1 }
      #user_data_format: RAW
      #user_data:
      #  str_replace:
      #    template: { get_file:  }
      #    params:
      #      manager_ip_address: { get_param: manager_ip }

  linux_server_port1:
    type: OS::Neutron::Port
    properties:
      network_id:       { get_param: group_net_name }
      security_groups:  { get_param: sec_group_linux }
      fixed_ips:
        - subnet_id:    { get_param: subnetA }

  linux_server_port2:
    type: OS::Neutron::Port
    properties:
      network_id:       { get_param: group_net_name }
      security_groups:  { get_param: sec_group_linux }
      fixed_ips:
        - subnet_id:    { get_param: subnetB }

outputs:
  port1:
    description: The network port of the linux node port 1.
    value: { get_resource: linux_server_port1 }
  port2:
    description: The network port of the linux node port 2.
    value: { get_resource: linux_server_port2}